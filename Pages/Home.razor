@page "/"

@inject IGeolocationService Geolocation

<PageTitle>Home</PageTitle>

<OpenStreetMap @ref="_map" Style="height:100%; width:100%">
    <Layers>
        <Layer SourceType="SourceType.TileWMS"
               Url="https: //tile.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}.png"
               Opacity=".3"
               CrossOrigin="anonymous">
        </Layer>
    </Layers>
</OpenStreetMap>

@code {

    readonly PositionOptions _options = new()
    {
        EnableHighAccuracy = true,

        MaximumAge = 1000D,
        Timeout = 10000D
    };

    GeolocationPosition? _position;
    GeolocationPositionError? _positionError;
    private Map? _map;
    bool _isLoading = true;


    protected override void OnInitialized()
    {
        Geolocation.WatchPosition(
            component: this,
            onSuccessCallbackMethodName: nameof(OnPositionReceived),
            onErrorCallbackMethodName: nameof(OnPositionError),
            options: _options);
    }

    [JSInvokable]
    public void OnPositionReceived(GeolocationPosition position)
    {
        _isLoading = false;
        _position = position;
        _map.SetCenter(new Coordinate(_position.Coords.Longitude, _position.Coords.Latitude));
        //_map.SetZoom(16);
        StateHasChanged();
    }

    [JSInvokable]
    public void OnPositionError(GeolocationPositionError positionError)
    {
        _isLoading = false;
        _positionError = positionError;
        StateHasChanged();
    }

}